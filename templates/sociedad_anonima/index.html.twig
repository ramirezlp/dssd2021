{% extends 'base.html.twig' %}

{% block title %}Formulario SA{% endblock %}

{% block body %}


      <div class="starter-template">
        <h1>Registro - Sociedad An√≥nima</h1>
          {{
          form_start(
            form,
            {
              attr: {
                class: 'horizontal-form',
              }
            }
          )
        }}
          <div class="offset-md-3 col-md-6">
              <div class="form-group">
                  {{ form_label(form.nombre) }}
                  <div class="form_field">
                      {{ form_widget(form.nombre) }}
                  </div>
              </div>
          </div>
          <div class="offset-md-3 col-md-6">
              <div class="form-group">
                  {{ form_label(form.domicilioLegal) }}
                  <div class="form_field">
                      {{ form_widget(form.domicilioLegal) }}
                  </div>
              </div>
          </div>
          <div class="offset-md-3 col-md-6">
              <div class="form-group">
                  {{ form_label(form.domicilioReal) }}
                  <div class="form_field">
                      {{ form_widget(form.domicilioReal) }}
                  </div>
              </div>
          </div>

           <div class="offset-md-3 col-md-6">
              <div class="form-group">
                  {{ form_label(form.mail) }}
                  <div class="form_field">
                      {{ form_widget(form.mail) }}
                  </div>
              </div>
          </div>
            <div class="offset-md-3 col-md-6">
              <div class="form-group">
                  <label class="required">Paises</label>
                  <div class="form_field">
                     <select class="form-control" id="paises">
                        <option>Selecciona un pais</option>
                    </select>
                  </div>
              </div>
          </div>
          <div class="offset-md-3 col-md-6">
              <div class="form-group">
                  <label class="required">Estados</label>
                  <div class="form_field">
                     <select class="form-control" id="estados">
                        <option>Selecciona un estado</option>
                    </select>
                  </div>
              </div>
          </div>
         <div class="offset-md-3 col-md-6">
              <div class="form-group">
                  {{ form_label(form.archivo) }}
                  <div class="form_field">
                      {{ form_widget(form.archivo) }}
                  </div>
              </div>
          </div>
        <div>
          <div class="row justify-content-center">
{{ form_widget(form.submit) }}
          {{ form_widget(form._token) }}
            {{
            form_end(
              form,
              {
                render_rest: false
              }
            )
          }}
        </div>
{% endblock %}
{% block javascripts %}
{{parent()}}
<script>
$( document ).ready(function() {
    cargarPaises();

    $('#paises').on('change', function() {
        $('#estados').find('option')
            .remove()
            .end()
            .append('<option>Selecciona un estado</option>')
        ;
        cargarEstados(this.value);
    });

    function cargarPaises() {
        $.ajax({
            url: "https://countries.trevorblades.com/",
            contentType: "application/json",
            type:'POST',
            data: JSON.stringify({ 
                query:  `query {
                            countries {
                                code,
                                name
                            }
                        }`
            }),
        success: function(result) {
            console.log(result);
            $.each(result.data.countries, function(i, obj) {
                var div_data="<option value="+obj.code+">"+obj.name+"</option>";
                $(div_data).appendTo('#paises'); 
            });  
        }});
    }

    function cargarEstados(codigoPais) {
        $.ajax({
            url: "https://countries.trevorblades.com/",
            contentType: "application/json",
            type:'POST',
            data: JSON.stringify({ 
                query:  `query {
                            country (code: "${codigoPais}") {
                                name,
                                states {
                                    name
                                }
                            }
                        }`
            }),
        success: function(result) {
            console.log(result);
            $.each(result.data.country.states, function(i, obj) {
                var div_data="<option value="+obj.name+">"+obj.name+"</option>";
                $(div_data).appendTo('#estados'); 
            });  
        }});
    }
});
</script>
{% endblock %}

